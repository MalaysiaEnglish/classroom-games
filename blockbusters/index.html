<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Blockbusters</title>
  <link rel="stylesheet" href="../style.css">
</head>

<body class="blockbusters-page">
  <h1>Blockbusters</h1>

  <div class="controls">
    <button id="goldBtn">Gold (Solo)</button>
    <button id="blueBtn">Blue (Team of 2)</button>
    <button id="restart">New Game</button>
    <button id="fullscreen">Fullscreen</button>
    <button id="home">Home</button>
  </div>

  <!-- ✅ Unified wrapper -->
  <div class="game-wrapper">

    <div id="currentTurn">Teacher: click Gold or Blue after a correct answer</div>

    <div class="blockbusters-board" id="board"></div>

    <div class="scoreboard">
      <div class="team-score" id="goldTeam">Gold (Solo)<br>0 wins</div>
      <div class="team-score" id="blueTeam">Blue (Team of 2)<br>0 wins</div>
    </div>

  </div>

  <script>
    const boardEl = document.getElementById('board');
    const currentTurnEl = document.getElementById('currentTurn');

    const ROWS = 4;
    const COLS = 5;
    let board = Array(ROWS).fill().map(() => Array(COLS).fill(null));
    let currentPlayer = null;
    let gameOver = false;
    let wins = { gold: 0, blue: 0 };

    const letters = 'ABCDEFGHIJKLMNOPQRST'.split('');

    const directions = [
      [-1, 0], [1, 0], [0, -1], [0, 1],
      [-1, -1], [1, 1], [-1, 1], [1, -1]
    ];

    function isValid(r, c) {
      return r >= 0 && r < ROWS && c >= 0 && c < COLS;
    }

    function createBoard() {
      boardEl.innerHTML = '';
      let idx = 0;
      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          const hex = document.createElement('div');
          hex.className = 'blockbusters-hex';
          hex.textContent = letters[idx++];
          hex.dataset.row = r;
          hex.dataset.col = c;
          hex.onclick = () => claimHex(r, c);
          boardEl.appendChild(hex);
        }
      }
    }

    function claimHex(row, col) {
      if (gameOver || currentPlayer === null || board[row][col]) return;

      board[row][col] = currentPlayer;
      const hex = boardEl.children[row * COLS + col];
      hex.classList.add(currentPlayer);

      const path = hasWinningPath(currentPlayer);
      if (path) {
        gameOver = true;
        wins[currentPlayer]++;
        updateScoreboard();
        currentTurnEl.textContent =
          currentPlayer === 'gold'
            ? 'Gold (Solo) WINS!'
            : 'Blue (Team of 2) WINS!';

        path.forEach(p => {
          const h = boardEl.children[p.row * COLS + p.col];
          h.classList.add('winning-path');
        });

        setTimeout(resetGame, 5000);
      } else {
        currentPlayer = null;
        currentTurnEl.textContent = "Teacher: click Gold or Blue for next turn";
      }
    }

    function hasWinningPath(player) {
      if (player === 'gold') {
        for (let c = 0; c < COLS; c++) {
          if (board[0][c] === 'gold') {
            const path = bfs([0, c], player, (r, c) => r === ROWS - 1);
            if (path) return path;
          }
        }
      } else {
        for (let r = 0; r < ROWS; r++) {
          if (board[r][0] === 'blue') {
            const path = bfs([r, 0], player, (r, c) => c === COLS - 1);
            if (path) return path;
          }
        }
      }
      return null;
    }

    function bfs(start, player, isGoal) {
      const queue = [[start]];
      const visited = Array(ROWS).fill().map(() => Array(COLS).fill(false));
      visited[start[0]][start[1]] = true;

      while (queue.length) {
        const path = queue.shift();
        const [r, c] = path[path.length - 1];

        if (isGoal(r, c)) return path;

        for (const [dr, dc] of directions) {
          const nr = r + dr, nc = c + dc;
          if (isValid(nr, nc) && !visited[nr][nc] && board[nr][nc] === player) {
            visited[nr][nc] = true;
            queue.push([...path, [nr, nc]]);
          }
        }
      }
      return null;
    }

    function updateScoreboard() {
      document.getElementById('goldTeam').innerHTML =
        `Gold (Solo)<br>${wins.gold} win${wins.gold !== 1 ? 's' : ''}`;
      document.getElementById('blueTeam').innerHTML =
        `Blue (Team of 2)<br>${wins.blue} win${wins.blue !== 1 ? 's' : ''}`;
    }

    function resetGame() {
      board = Array(ROWS).fill().map(() => Array(COLS).fill(null));
      gameOver = false;
      currentPlayer = null;
      createBoard();
      currentTurnEl.textContent =
        "Teacher: click Gold or Blue after a correct answer";
      updateScoreboard();
    }

    document.getElementById('goldBtn').onclick = () => {
      if (!gameOver) {
        currentPlayer = 'gold';
        currentTurnEl.textContent = "Gold (Solo) – click a hexagon!";
      }
    };

    document.getElementById('blueBtn').onclick = () => {
      if (!gameOver) {
        currentPlayer = 'blue';
        currentTurnEl.textContent = "Blue (Team of 2) – click a hexagon!";
      }
    };

    document.getElementById('restart').onclick = resetGame;
    document.getElementById('fullscreen').onclick =
      () => document.documentElement.requestFullscreen?.();
    document.getElementById('home').onclick =
      () => window.location.href = '../index.html';

    createBoard();
    updateScoreboard();
  </script>

</body>
</html>