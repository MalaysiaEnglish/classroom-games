<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Slogan Matcher</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:      #f5f0e8;
      --ink:     #1a1208;
      --card:    #ffffff;
      --accent:  #e63946;
      --accent2: #2b9348;
      --gold:    #f4a261;
      --muted:   #8a7f6e;
      --radius:  10px;
      --shadow:  0 4px 20px rgba(0,0,0,0.12);
    }

    *, *::before, *::after { box-sizing: border-box; margin:0; padding:0; }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--ink);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Newspaper texture overlay */
    body::before {
      content: '';
      position: fixed; inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4'%3E%3Crect width='4' height='4' fill='%23f5f0e8'/%3E%3Crect x='0' y='0' width='1' height='1' fill='%23e8e0d0' opacity='0.4'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 0;
    }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    header {
      position: relative;
      z-index: 1;
      background: var(--ink);
      color: var(--bg);
      padding: 0;
      text-align: center;
      border-bottom: 4px solid var(--accent);
    }

    .masthead {
      padding: 16px 20px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .masthead-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 6px;
    }

    h1 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(2.2rem, 7vw, 3.8rem);
      letter-spacing: 0.06em;
      color: var(--bg);
      flex: 1;
      text-align: center;
    }

    h1 span { color: var(--accent); }

    .tagline {
      font-size: 0.75rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: rgba(245,240,232,0.5);
      font-weight: 300;
    }

    /* ‚îÄ‚îÄ Nav bar ‚îÄ‚îÄ */
    .game-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      background: rgba(255,255,255,0.05);
      flex-wrap: wrap;
      gap: 8px;
    }

    .nav-btn {
      padding: 7px 16px;
      border-radius: 4px;
      border: 1px solid rgba(255,255,255,0.2);
      background: transparent;
      color: var(--bg);
      font-family: 'DM Sans', sans-serif;
      font-size: 0.82rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.18s;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .nav-btn:hover { background: rgba(255,255,255,0.1); }
    .nav-btn.primary { background: var(--accent); border-color: var(--accent); color: white; }
    .nav-btn.primary:hover { background: #c1121f; }

    .score-display {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .score-badge {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 6px;
      padding: 5px 14px;
      font-family: 'Bebas Neue', sans-serif;
      font-size: 1.1rem;
      letter-spacing: 0.08em;
      color: var(--gold);
    }

    /* ‚îÄ‚îÄ Main ‚îÄ‚îÄ */
    main {
      position: relative;
      z-index: 1;
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 16px 60px;
    }

    /* ‚îÄ‚îÄ Setup screen ‚îÄ‚îÄ */
    #setupScreen {
      max-width: 560px;
      margin: 40px auto;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .setup-header {
      background: var(--ink);
      color: var(--bg);
      padding: 20px 24px;
      font-family: 'Bebas Neue', sans-serif;
      font-size: 1.4rem;
      letter-spacing: 0.06em;
      border-bottom: 3px solid var(--accent);
    }

    .setup-body { padding: 24px; }

    .setup-option {
      margin-bottom: 20px;
    }

    .setup-option label {
      display: block;
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .option-pills {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .pill {
      padding: 8px 16px;
      border-radius: 40px;
      border: 2px solid #ddd;
      background: white;
      color: var(--ink);
      font-size: 0.88rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
    }

    .pill:hover { border-color: var(--accent); }
    .pill.selected { background: var(--accent); border-color: var(--accent); color: white; }

    .start-btn {
      width: 100%;
      padding: 14px;
      background: var(--ink);
      color: var(--bg);
      border: none;
      border-radius: var(--radius);
      font-family: 'Bebas Neue', sans-serif;
      font-size: 1.3rem;
      letter-spacing: 0.1em;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 8px;
    }

    .start-btn:hover { background: var(--accent); }

    /* ‚îÄ‚îÄ Teams setup ‚îÄ‚îÄ */
    .teams-row {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
      margin-top: 16px;
    }

    .team-input-wrap { position: relative; }

    .team-color-dot {
      position: absolute;
      left: 10px; top: 50%;
      transform: translateY(-50%);
      width: 12px; height: 12px;
      border-radius: 50%;
    }

    .team-input {
      width: 100%;
      padding: 9px 10px 9px 28px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.88rem;
      outline: none;
      transition: border-color 0.15s;
    }

    .team-input:focus { border-color: var(--accent); }

    /* ‚îÄ‚îÄ Game screen ‚îÄ‚îÄ */
    #gameScreen { display: none; }

    .game-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      align-items: start;
    }

    @media (max-width: 700px) {
      .game-layout { grid-template-columns: 1fr; }
    }

    .column-label {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 1rem;
      letter-spacing: 0.1em;
      color: var(--muted);
      text-transform: uppercase;
      margin-bottom: 10px;
      padding-bottom: 6px;
      border-bottom: 2px solid currentColor;
    }

    /* ‚îÄ‚îÄ Brand cards ‚îÄ‚îÄ */
    .brands-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .brand-card {
      background: var(--card);
      border: 2px solid #e0d8cc;
      border-radius: var(--radius);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: all 0.18s;
      user-select: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }

    .brand-card:hover:not(.matched):not(.selected) {
      border-color: var(--accent);
      transform: translateX(4px);
    }

    .brand-card.selected {
      border-color: var(--accent);
      background: #fff5f5;
      box-shadow: 0 0 0 3px rgba(230,57,70,0.15);
    }

    .brand-card.matched {
      border-color: var(--accent2);
      background: #f0faf2;
      opacity: 0.7;
      cursor: default;
    }

    .brand-card.wrong {
      animation: shake 0.4s ease;
      border-color: var(--accent);
    }

    .brand-emoji { font-size: 1.6rem; flex-shrink: 0; }

    .brand-name {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 1.2rem;
      letter-spacing: 0.05em;
    }

    .brand-check {
      margin-left: auto;
      font-size: 1.2rem;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .brand-card.matched .brand-check { opacity: 1; }

    /* ‚îÄ‚îÄ Slogan cards ‚îÄ‚îÄ */
    .slogans-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .slogan-card {
      background: var(--ink);
      color: var(--bg);
      border: 2px solid transparent;
      border-radius: var(--radius);
      padding: 13px 16px;
      cursor: pointer;
      transition: all 0.18s;
      user-select: none;
      font-style: italic;
      font-size: 0.95rem;
      line-height: 1.4;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      position: relative;
    }

    .slogan-card:hover:not(.matched):not(.used) {
      border-color: var(--gold);
      transform: translateX(-4px);
    }

    .slogan-card.used {
      opacity: 0.35;
      cursor: default;
      pointer-events: none;
    }

    .slogan-card.flash-correct {
      animation: flashGreen 0.5s ease;
    }

    .slogan-card.flash-wrong {
      animation: flashRed 0.4s ease;
    }

    .matched-brand-tag {
      display: inline-block;
      margin-top: 6px;
      font-style: normal;
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--accent2);
      background: rgba(43,147,72,0.15);
      padding: 2px 8px;
      border-radius: 20px;
    }

    /* ‚îÄ‚îÄ Team scoreboard ‚îÄ‚îÄ */
    .scoreboard {
      margin-top: 20px;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .scoreboard-header {
      background: var(--ink);
      color: var(--bg);
      padding: 10px 16px;
      font-family: 'Bebas Neue', sans-serif;
      font-size: 1rem;
      letter-spacing: 0.08em;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .scoreboard-body {
      display: flex;
      gap: 0;
    }

    .team-score-cell {
      flex: 1;
      padding: 12px;
      text-align: center;
      border-right: 1px solid #f0ebe0;
    }

    .team-score-cell:last-child { border-right: none; }

    .ts-name {
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .ts-points {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 2rem;
      line-height: 1;
      transition: all 0.3s;
    }

    .ts-points.bump {
      animation: bump 0.4s ease;
      color: var(--accent2);
    }

    /* ‚îÄ‚îÄ Turn indicator ‚îÄ‚îÄ */
    .turn-bar {
      background: var(--card);
      border-radius: var(--radius);
      padding: 12px 16px;
      margin-bottom: 16px;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 8px;
    }

    .turn-label {
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .turn-team {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 1.3rem;
      letter-spacing: 0.05em;
    }

    .turn-instruction {
      font-size: 0.82rem;
      color: var(--muted);
      font-style: italic;
    }

    /* ‚îÄ‚îÄ End screen ‚îÄ‚îÄ */
    #endScreen {
      display: none;
      max-width: 500px;
      margin: 40px auto;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      text-align: center;
    }

    .end-header {
      background: var(--ink);
      color: var(--bg);
      padding: 24px;
      border-bottom: 4px solid var(--gold);
    }

    .end-header h2 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 2.2rem;
      letter-spacing: 0.08em;
      color: var(--gold);
    }

    .end-body { padding: 24px; }

    .final-scores {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 20px;
    }

    .final-score-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px;
      border-radius: 8px;
      background: #f8f4ed;
    }

    .final-score-row.winner {
      background: var(--ink);
      color: var(--bg);
    }

    .final-score-row.winner .fsr-points { color: var(--gold); }

    .fsr-name { font-weight: 600; font-size: 0.95rem; }
    .fsr-points { font-family: 'Bebas Neue', sans-serif; font-size: 1.4rem; }

    .winner-crown { font-size: 2rem; margin-bottom: 8px; }

    /* ‚îÄ‚îÄ Animations ‚îÄ‚îÄ */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-6px); }
      75% { transform: translateX(6px); }
    }

    @keyframes flashGreen {
      0% { background: var(--ink); }
      50% { background: #2b9348; }
      100% { background: var(--ink); }
    }

    @keyframes flashRed {
      0% { background: var(--ink); }
      50% { background: var(--accent); }
      100% { background: var(--ink); }
    }

    @keyframes bump {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    @keyframes fadeUp {
      from { opacity:0; transform: translateY(12px); }
      to   { opacity:1; transform: translateY(0); }
    }

    .fade-up { animation: fadeUp 0.3s ease both; }
  </style>
</head>
<body>

<header>
  <div class="masthead">
    <div class="masthead-top">
      <h1>Slogan <span>Matcher</span></h1>
    </div>
    <div class="tagline">Unit 8 ¬∑ Advertising ¬∑ Match the brand to its slogan</div>
  </div>
  <div class="game-nav">
    <div>
      <a href="../index.html" class="nav-btn">üè† Home</a>
      <button class="nav-btn" id="restartBtn" style="display:none" onclick="restartGame()">‚Ü∫ Restart</button>
    </div>
    <div class="score-display">
      <span id="progressBadge" class="score-badge" style="display:none">0 / 11</span>
    </div>
  </div>
</header>

<main>

  <!-- ‚îÄ‚îÄ SETUP ‚îÄ‚îÄ -->
  <div id="setupScreen">
    <div class="setup-header">‚öôÔ∏è Game Setup</div>
    <div class="setup-body">

      <div class="setup-option">
        <label>Number of Teams</label>
        <div class="option-pills" id="teamCountPicker">
          <button class="pill" data-n="1">Solo</button>
          <button class="pill selected" data-n="2">2 Teams</button>
          <button class="pill" data-n="3">3 Teams</button>
          <button class="pill" data-n="4">4 Teams</button>
        </div>
      </div>

      <div class="setup-option">
        <label>Points per correct match</label>
        <div class="option-pills" id="pointsPicker">
          <button class="pill" data-p="1">1 pt</button>
          <button class="pill selected" data-p="2">2 pts</button>
          <button class="pill" data-p="3">3 pts</button>
          <button class="pill" data-p="5">5 pts</button>
        </div>
      </div>

      <div class="setup-option" id="penaltyOption">
        <label>Wrong answer penalty</label>
        <div class="option-pills" id="penaltyPicker">
          <button class="pill selected" data-pen="0">No penalty</button>
          <button class="pill" data-pen="1">‚àí1 pt</button>
          <button class="pill" data-pen="2">‚àí2 pts</button>
        </div>
      </div>

      <div class="setup-option" id="teamNamesSection">
        <label>Team Names</label>
        <div class="teams-row" id="teamNamesRow"></div>
      </div>

      <button class="start-btn" onclick="startGame()">‚ñ∂ START GAME</button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ GAME ‚îÄ‚îÄ -->
  <div id="gameScreen">
    <div class="turn-bar" id="turnBar">
      <div>
        <div class="turn-label">Current Turn</div>
        <div class="turn-team" id="turnTeamName">‚Äî</div>
      </div>
      <div class="turn-instruction" id="turnInstruction">Select a brand, then select its slogan</div>
    </div>

    <div class="game-layout">
      <div>
        <div class="column-label">üè¢ Brands</div>
        <div class="brands-list" id="brandsList"></div>
      </div>
      <div>
        <div class="column-label">üí¨ Slogans</div>
        <div class="slogans-list" id="slogansList"></div>
      </div>
    </div>

    <div class="scoreboard" id="scoreboard">
      <div class="scoreboard-header">
        <span>üìä Scoreboard</span>
        <span id="matchCount" style="font-size:0.85rem;opacity:0.7;">0 of 11 matched</span>
      </div>
      <div class="scoreboard-body" id="scoreboardBody"></div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ END ‚îÄ‚îÄ -->
  <div id="endScreen">
    <div class="end-header">
      <div class="winner-crown">üèÜ</div>
      <h2 id="winnerText">Game Over!</h2>
      <div id="winnerSub" style="font-size:0.9rem;opacity:0.7;margin-top:4px;"></div>
    </div>
    <div class="end-body">
      <div class="final-scores" id="finalScores"></div>
      <button class="start-btn" onclick="restartGame()">‚Ü∫ Play Again</button>
    </div>
  </div>

</main>

<script>
  // ‚îÄ‚îÄ Data ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const ALL_PAIRS = [
    { brand: "McDonald's",          emoji: "üçî", slogan: "I'm lovin' it" },
    { brand: "Nike",                emoji: "üëü", slogan: "Just do it" },
    { brand: "KFC",                 emoji: "üçó", slogan: "Finger lickin' good" },
    { brand: "Gillette",            emoji: "ü™í", slogan: "The best a man can get" },
    { brand: "L'Or√©al",             emoji: "üíÑ", slogan: "Because I'm worth it" },
    { brand: "Twix",                emoji: "üç´", slogan: "None for you, two for me" },
    { brand: "Disneyland",          emoji: "üè∞", slogan: "The happiest place on earth" },
    { brand: "Kellogg's Frosties",  emoji: "üêØ", slogan: "They're great!" },
    { brand: "Kit Kat",             emoji: "üç¨", slogan: "Have a break, have a‚Ä¶" },
    { brand: "Sprite",              emoji: "ü•§", slogan: "Obey your thirst" },
    { brand: "Red Bull",            emoji: "üêÇ", slogan: "It gives you wings" },
  ];

  const TEAM_COLORS = ['#e63946','#2b9348','#f4a261','#4361ee','#7209b7','#3a86ff'];

  // ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let teams = [];
  let currentTeamIdx = 0;
  let pointsPerMatch = 2;
  let penalty = 0;
  let selectedBrand = null;
  let matchedCount = 0;
  let pairs = [];

  // ‚îÄ‚îÄ Setup UI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let numTeams = 2;

  document.querySelectorAll('#teamCountPicker .pill').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('#teamCountPicker .pill').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      numTeams = parseInt(btn.dataset.n);
      buildTeamNameInputs();
    });
  });

  document.querySelectorAll('#pointsPicker .pill').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('#pointsPicker .pill').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      pointsPerMatch = parseInt(btn.dataset.p);
    });
  });

  document.querySelectorAll('#penaltyPicker .pill').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('#penaltyPicker .pill').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      penalty = parseInt(btn.dataset.pen);
    });
  });

  function buildTeamNameInputs() {
    const row = document.getElementById('teamNamesRow');
    row.innerHTML = '';
    const defaultNames = ['Team A','Team B','Team C','Team D','Team E','Team F'];
    for (let i = 0; i < numTeams; i++) {
      const wrap = document.createElement('div');
      wrap.className = 'team-input-wrap';
      const dot = document.createElement('div');
      dot.className = 'team-color-dot';
      dot.style.background = TEAM_COLORS[i];
      const input = document.createElement('input');
      input.className = 'team-input';
      input.type = 'text';
      input.placeholder = defaultNames[i];
      input.value = defaultNames[i];
      wrap.appendChild(dot);
      wrap.appendChild(input);
      row.appendChild(wrap);
    }
    document.getElementById('teamNamesSection').style.display = numTeams > 1 ? '' : 'none';
  }

  buildTeamNameInputs();

  function startGame() {
    const inputs = document.querySelectorAll('.team-input');
    teams = [];
    for (let i = 0; i < numTeams; i++) {
      teams.push({
        name: (inputs[i] && inputs[i].value.trim()) || `Team ${String.fromCharCode(65+i)}`,
        color: TEAM_COLORS[i],
        score: 0
      });
    }
    currentTeamIdx = 0;
    selectedBrand = null;
    matchedCount = 0;

    // Shuffle pairs
    pairs = [...ALL_PAIRS].sort(() => Math.random() - 0.5);

    document.getElementById('setupScreen').style.display = 'none';
    document.getElementById('gameScreen').style.display = 'block';
    document.getElementById('restartBtn').style.display = 'inline-flex';
    document.getElementById('progressBadge').style.display = 'inline-block';

    buildScoreboard();
    renderGame();
    updateTurnBar();
  }

  // ‚îÄ‚îÄ Scoreboard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function buildScoreboard() {
    const body = document.getElementById('scoreboardBody');
    body.innerHTML = '';
    if (teams.length === 1) {
      document.getElementById('scoreboard').style.display = 'none';
      return;
    }
    teams.forEach((t, i) => {
      const cell = document.createElement('div');
      cell.className = 'team-score-cell';
      cell.innerHTML = `
        <div class="ts-name" style="color:${t.color}">${t.name}</div>
        <div class="ts-points" id="score-${i}">0</div>
      `;
      body.appendChild(cell);
    });
  }

  function updateScoreboard() {
    teams.forEach((t, i) => {
      const el = document.getElementById(`score-${i}`);
      if (el) el.textContent = t.score;
    });
    document.getElementById('matchCount').textContent = `${matchedCount} of ${pairs.length} matched`;
    document.getElementById('progressBadge').textContent = `${matchedCount} / ${pairs.length}`;
  }

  function bumpScore(idx) {
    const el = document.getElementById(`score-${idx}`);
    if (el) {
      el.classList.remove('bump');
      void el.offsetWidth;
      el.classList.add('bump');
    }
  }

  // ‚îÄ‚îÄ Turn bar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function updateTurnBar() {
    const t = teams[currentTeamIdx];
    document.getElementById('turnTeamName').textContent = teams.length > 1 ? t.name : 'Your Turn';
    document.getElementById('turnTeamName').style.color = t.color;
  }

  function nextTurn() {
    currentTeamIdx = (currentTeamIdx + 1) % teams.length;
    updateTurnBar();
  }

  // ‚îÄ‚îÄ Render game ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderGame() {
    const brandsList  = document.getElementById('brandsList');
    const slogansList = document.getElementById('slogansList');
    brandsList.innerHTML  = '';
    slogansList.innerHTML = '';

    // Shuffle slogans independently
    const shuffledSlogans = [...pairs].sort(() => Math.random() - 0.5);

    pairs.forEach((p, i) => {
      // Brand card
      const bc = document.createElement('div');
      bc.className = 'brand-card fade-up';
      bc.dataset.idx = i;
      bc.style.animationDelay = `${i * 0.04}s`;
      bc.innerHTML = `
        <span class="brand-emoji">${p.emoji}</span>
        <span class="brand-name">${p.brand}</span>
        <span class="brand-check">‚úì</span>
      `;
      bc.addEventListener('click', () => selectBrand(i));
      brandsList.appendChild(bc);
    });

    shuffledSlogans.forEach((p, i) => {
      const originalIdx = pairs.indexOf(p);
      const sc = document.createElement('div');
      sc.className = 'slogan-card fade-up';
      sc.dataset.idx = originalIdx;
      sc.style.animationDelay = `${i * 0.04}s`;
      sc.textContent = `"${p.slogan}"`;
      sc.addEventListener('click', () => selectSlogan(originalIdx, sc));
      slogansList.appendChild(sc);
    });

    updateScoreboard();
  }

  // ‚îÄ‚îÄ Interaction ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function selectBrand(idx) {
    const cards = document.querySelectorAll('.brand-card');
    const card  = [...cards].find(c => parseInt(c.dataset.idx) === idx);
    if (!card || card.classList.contains('matched')) return;

    // Deselect previous
    cards.forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');
    selectedBrand = idx;

    document.getElementById('turnInstruction').textContent = `Now select the slogan for "${pairs[idx].brand}"`;
  }

  function selectSlogan(idx, el) {
    if (el.classList.contains('used')) return;

    if (selectedBrand === null) {
      document.getElementById('turnInstruction').textContent = 'Select a brand first!';
      return;
    }

    const brandCards  = document.querySelectorAll('.brand-card');
    const brandCard   = [...brandCards].find(c => parseInt(c.dataset.idx) === selectedBrand);

    if (idx === selectedBrand) {
      // ‚úÖ Correct!
      el.classList.add('flash-correct', 'used');
      const tag = document.createElement('div');
      tag.className = 'matched-brand-tag';
      tag.textContent = `‚úì ${pairs[idx].brand}`;
      el.appendChild(tag);

      if (brandCard) brandCard.classList.add('matched');

      teams[currentTeamIdx].score += pointsPerMatch;
      matchedCount++;
      bumpScore(currentTeamIdx);
      updateScoreboard();

      selectedBrand = null;
      document.getElementById('turnInstruction').textContent = 'Select a brand, then select its slogan';
      brandCards.forEach(c => c.classList.remove('selected'));

      setTimeout(() => el.classList.remove('flash-correct'), 500);

      if (matchedCount === pairs.length) {
        setTimeout(showEndScreen, 600);
        return;
      }

      // Auto-advance turn
      setTimeout(() => nextTurn(), 400);

    } else {
      // ‚ùå Wrong
      el.classList.add('flash-wrong');
      if (brandCard) brandCard.classList.add('wrong');

      teams[currentTeamIdx].score = Math.max(0, teams[currentTeamIdx].score - penalty);
      updateScoreboard();

      setTimeout(() => {
        el.classList.remove('flash-wrong');
        if (brandCard) brandCard.classList.remove('wrong');
      }, 400);

      selectedBrand = null;
      brandCards.forEach(c => c.classList.remove('selected'));
      document.getElementById('turnInstruction').textContent = `Wrong! Select a brand, then select its slogan`;

      setTimeout(() => {
        document.getElementById('turnInstruction').textContent = 'Select a brand, then select its slogan';
        nextTurn();
      }, 1200);
    }
  }

  // ‚îÄ‚îÄ End screen ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function showEndScreen() {
    document.getElementById('gameScreen').style.display = 'none';
    const end = document.getElementById('endScreen');
    end.style.display = 'block';

    if (teams.length === 1) {
      document.getElementById('winnerText').textContent = `You scored ${teams[0].score} pts!`;
      document.getElementById('winnerSub').textContent = `Out of a possible ${pairs.length * pointsPerMatch}`;
      document.getElementById('finalScores').innerHTML = '';
      return;
    }

    const sorted = [...teams].sort((a,b) => b.score - a.score);
    const maxScore = sorted[0].score;
    const winners  = sorted.filter(t => t.score === maxScore);

    if (winners.length === 1) {
      document.getElementById('winnerText').textContent = `${winners[0].name} Wins!`;
    } else {
      document.getElementById('winnerText').textContent = `It's a Tie!`;
    }
    document.getElementById('winnerSub').textContent = `All ${pairs.length} slogans matched`;

    const fs = document.getElementById('finalScores');
    fs.innerHTML = '';
    sorted.forEach((t, i) => {
      const row = document.createElement('div');
      row.className = 'final-score-row' + (i === 0 ? ' winner' : '');
      row.innerHTML = `
        <span class="fsr-name" style="color:${i===0?'#f5f0e8':t.color}">${i===0?'ü•á ':''}${t.name}</span>
        <span class="fsr-points">${t.score} pts</span>
      `;
      fs.appendChild(row);
    });
  }

  function restartGame() {
    document.getElementById('endScreen').style.display   = 'none';
    document.getElementById('gameScreen').style.display  = 'none';
    document.getElementById('setupScreen').style.display = 'block';
    document.getElementById('restartBtn').style.display  = 'none';
    document.getElementById('progressBadge').style.display = 'none';
    numTeams = 2;
    document.querySelectorAll('#teamCountPicker .pill').forEach(b => {
      b.classList.toggle('selected', b.dataset.n === '2');
    });
    buildTeamNameInputs();
  }
</script>

</body>
</html>
