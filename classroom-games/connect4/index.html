<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Connect 4</title>
  <link rel="stylesheet" href="../style.css">
</head>

<body class="connect4-page">
  <h1>Connect 4 â€“ Classroom Edition</h1>

  <div class="controls">
    <button id="redBtn">Team 1 (Red)</button>
    <button id="yellowBtn">Team 2 (Yellow)</button>
    <button id="playToEnd">Play to End Mode</button>
    <button id="newBoard">New Board</button>
    <button id="fullscreen">Fullscreen</button>
    <button id="home">Home</button>
  </div>

  <!-- âœ… Unified wrapper -->
  <div class="game-wrapper">

    <div id="currentTurn">Team 1 (Red) â€” pick a column!</div>

    <!-- Column selector buttons â€” students call the number, teacher clicks -->
    <div class="col-selector" id="colSelector"></div>

    <div class="connect4-board" id="board"></div>

    <div class="scoreboard">
      <div class="team-score" id="team1">Team 1 (Red)<br>0 wins</div>
      <div class="team-score" id="team2">Team 2 (Yellow)<br>0 wins</div>
    </div>

  </div>

  <script>
    const boardEl = document.getElementById('board');
    const currentTurnEl = document.getElementById('currentTurn');

    const ROWS = 6, COLS = 7;
    let board = Array(ROWS).fill().map(() => Array(COLS).fill(null));
    let currentPlayer = 'red', gameOver = false, playToEnd = false;
    let wins = { red: 0, yellow: 0 };
    let resetTimer = null;

    function updateActiveTeam() {
      document.getElementById('team1').classList.toggle('active', currentPlayer === 'red');
      document.getElementById('team2').classList.toggle('active', currentPlayer === 'yellow');
    }

    function createBoard() {
      boardEl.innerHTML = '';
      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          const cell = document.createElement('div');
          cell.className = 'connect4-cell';
          cell.dataset.col = c;
          cell.onclick = () => dropToken(c);
          boardEl.appendChild(cell);
        }
      }
      buildColSelector();
    }

    function buildColSelector() {
      const sel = document.getElementById('colSelector');
      sel.innerHTML = '';
      for (let c = 0; c < COLS; c++) {
        const btn = document.createElement('button');
        btn.textContent = c + 1;
        btn.className = 'col-btn';
        btn.dataset.col = c;
        btn.onclick = () => dropToken(c);
        sel.appendChild(btn);
      }
    }

    function highlightCol(col) {
      document.querySelectorAll('.col-btn').forEach((btn, i) => {
        btn.classList.toggle('col-active', i === col);
      });
      // fade after 600ms
      setTimeout(() => document.querySelectorAll('.col-btn')
        .forEach(b => b.classList.remove('col-active')), 600);
    }

    function dropToken(col) {
      if (gameOver || currentPlayer === null) return;
      highlightCol(col);
      for (let r = ROWS - 1; r >= 0; r--) {
        if (!board[r][col]) {
          board[r][col] = currentPlayer;

          const cell = boardEl.children[r * COLS + col];
          const token = document.createElement('div');
          token.className = `connect4-token ${currentPlayer}`;
          cell.appendChild(token);
          requestAnimationFrame(() => token.style.transform = 'translateY(0)');

          const newLines = countNewLines(r, col);
          if (newLines > 0) {
            wins[currentPlayer] += newLines;
            updateScoreboard();
            if (!playToEnd) {
              gameOver = true;
              currentTurnEl.textContent = `${currentPlayer==='red'?'Team 1':'Team 2'} WINS! ðŸŽ‰ New game in 4 seconds...`;
              if (resetTimer) clearTimeout(resetTimer);
              resetTimer = setTimeout(resetGame, 4000);
            } else {
              const msg = newLines > 1 ? `scores ${newLines} lines!` : `scores a line!`;
              currentTurnEl.textContent = `${currentPlayer==='red'?'Team 1':'Team 2'} ${msg} Keep going!`;
            }
          }

          if (playToEnd && isBoardFull()) {
            gameOver = true;
            const winner = wins.red > wins.yellow ? 'Team 1 (Red)' :
                           wins.yellow > wins.red ? 'Team 2 (Yellow)' : 'Nobody â€” it\'s a tie';
            currentTurnEl.textContent =
              `Board full! ${winner} wins! Red: ${wins.red} lines â€“ Yellow: ${wins.yellow} lines`;
          }

          if (!gameOver) {
            currentPlayer = currentPlayer === 'red' ? 'yellow' : 'red';
            const nextName = currentPlayer === 'red' ? 'Team 1 (Red)' : 'Team 2 (Yellow)';
            currentTurnEl.textContent = `${nextName} â€” pick a column!`;
            updateActiveTeam();
          }
          return;
        }
      }
      alert("Column full!");
    }

    function countNewLines(row, col) {
      // Count lines of EXACTLY 4 through (row,col) â€” not 5+ (already scored)
      const p = board[row][col];
      const dirs = [[1,0],[0,1],[1,1],[1,-1]];
      let newLines = 0;
      for (const [dr,dc] of dirs) {
        let count = 1;
        for (let i = 1; i < 7; i++) {
          const r = row + dr*i, c = col + dc*i;
          if (r>=0 && r<ROWS && c>=0 && c<COLS && board[r][c] === p) count++;
          else break;
        }
        for (let i = 1; i < 7; i++) {
          const r = row - dr*i, c = col - dc*i;
          if (r>=0 && r<ROWS && c>=0 && c<COLS && board[r][c] === p) count++;
          else break;
        }
        if (count === 4) newLines++;
      }
      return newLines;
    }

    function isBoardFull() {
      return board[0].every(c => c !== null);
    }

    function updateScoreboard() {
      document.getElementById('team1').innerHTML =
        `Team 1 (Red)<br>${wins.red} line${wins.red!==1?'s':''}`;
      document.getElementById('team2').innerHTML =
        `Team 2 (Yellow)<br>${wins.yellow} line${wins.yellow!==1?'s':''}`;
    }

    function resetGame() {
      if (resetTimer) { clearTimeout(resetTimer); resetTimer = null; }
      board = Array(ROWS).fill().map(() => Array(COLS).fill(null));
      gameOver = false;
      currentPlayer = 'red';
      createBoard();
      currentTurnEl.textContent = "Team 1 (Red) â€” pick a column!";
      updateScoreboard();
      updateActiveTeam();
    }

    document.getElementById('redBtn').onclick = () => {
      if (!gameOver) {
        currentPlayer = 'red';
        currentTurnEl.textContent = "Team 1 (Red) â€” pick a column!";
        updateActiveTeam();
      }
    };

    document.getElementById('yellowBtn').onclick = () => {
      if (!gameOver) {
        currentPlayer = 'yellow';
        currentTurnEl.textContent = "Team 2 (Yellow) â€” pick a column!";
        updateActiveTeam();
      }
    };

    document.getElementById('playToEnd').onclick = () => {
      playToEnd = !playToEnd;
      if (resetTimer) { clearTimeout(resetTimer); resetTimer = null; }
      document.getElementById('playToEnd').textContent =
        playToEnd ? "First to 4 Mode" : "Play to End Mode";
    };

    document.getElementById('newBoard').onclick = resetGame;

    document.getElementById('fullscreen').onclick =
      () => document.documentElement.requestFullscreen?.();

    document.getElementById('home').onclick =
      () => window.location.href = '../index.html';

    createBoard();
    updateScoreboard();
    updateActiveTeam();
  </script>

</body>
</html>